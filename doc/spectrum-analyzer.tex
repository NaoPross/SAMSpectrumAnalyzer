\documentclass[a4paper, 10pt]{report}

% metadata
% ---------------------------------------------------------------------------

\newcommand{\name}{Naoki Pross}
\newcommand{\instructor}{Rinaldo Geiler, Daniele Kamm}
\newcommand{\specialization}{S.2 Sviluppare prototipi}

\newcommand{\project}{Spectrum Analyzer}
\newcommand{\projstart}{12.04.2018}
\newcommand{\projend}{15.05.2018}
\newcommand{\projectyear}{2017-18}

\newcommand{\plannedtime}{83 UD}
\newcommand{\actualtime}{-- UD}

% ---------------------------------------------------------------------------
% layout
\usepackage[
    inner=3cm,
    outer=3cm,
    top=3.5cm,
    bottom=3.5cm
]{geometry}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{CAM-SAM}
\fancyhead[C]{Elettronico}
\fancyhead[R]{\today}
\fancyfoot[L]{\jobname.tex}
\fancyfoot[C]{\name}
\fancyfoot[R]{\thepage}

\usepackage{afterpage}
\usepackage{titlesec}

\titleformat{\chapter}[hang]{\Huge\bfseries}
    {\thechapter}{.5em}{\thispagestyle{fancy}}
\titlespacing*{\chapter}{0pt}{-30pt}{10pt}

% language
\usepackage[italian]{babel}

% quotes
\usepackage{csquotes}
\usepackage{fancyvrb}

% sans serif font
\renewcommand{\familydefault}{\sfdefault}

% urls
\usepackage[
    colorlinks=true,
    linkcolor=.,
	citecolor=.,
    urlcolor=blue
]{hyperref}

% maths
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

% logo
\usepackage{metalogo}

% figures
\usepackage{float}
\usepackage{subfig}
% tables
\usepackage{array}
\usepackage{booktabs}
\usepackage{tabularx}
% plots
\usepackage{pgfplots}
\usepgfplotslibrary{fillbetween}
\pgfplotsset{compat=1.14}
% diagrams
\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{quotes}
\usetikzlibrary{patterns}
\usetikzlibrary{angles}
\usepackage[european]{circuitikz}
\usepackage{tikz-timing}
\usepackage{tikzscale}

% include PDFs
\usepackage{pdfpages}

% code
\usepackage{xcolor}
\usepackage{listings}

\lstdefinelanguage{diff}{
    sensitive=true,
    % diff command line
    morecomment=[f][\color{gray}][0]{diff},
    % commit identifiers for git diff
    morecomment=[f][\color{gray}][0]{index},
    % hunk location/line numbers for unified format
    morecomment=[f][\color{blue}][0]{@@},
    % hunk location/line numbers for context format
    morecomment=[f][\color{magenta}][0]{***},
    % changed line for context format
    morecomment=[f][\color{violet}][0]{!},
    % deleted lines for unified format
    morecomment=[f][\color{red!60!black}][0]-,
    % added lines for unified format
    morecomment=[f][\color{green!60!black}][0]+,
    % file name and time stamp old file
    morecomment=[f][\color{magenta}][0]{---},
    % file name and time stamp new file
    morecomment=[f][\color{magenta}][0]{+++},
    % Binary files ... differ
    morecomment=[f][\color{gray}][0]{Binary},
    % Only in ...: file.txt
    morecomment=[f][\color{gray}][0]{Only},
    % old mode ...
    morecomment=[f][\color{gray}][0]{old},
    % new mode ...
    morecomment=[f][\color{gray}][0]{new},
    % rename from/to ...
    morecomment=[f][\color{gray}][0]{rename},
    % similarity index ...%
    morecomment=[f][\color{gray}][0]{similarity},
    % deleted file mode ...%
    morecomment=[f][\color{gray}][0]{deleted},
    % hunk separator for context format
    morecomment=[f][\color{magenta}][0]{***************},
    % deleted lines for normal format
    morecomment=[f][\color{red!60!black}][0]<,
    % added lines for normal format
    morecomment=[f][\color{green!60!black}][0]>,
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{0},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{1},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{2},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{3},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{4},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{5},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{6},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{7},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{8},
    % line number specifier for normal format
    morecomment=[f][\color{blue}][0]{9},
}[comments]

\lstdefinestyle{cc}{
    belowcaptionskip=1\baselineskip,
    breaklines=true,
    frame=none,
    % margin
    xleftmargin=\parindent,
    % numbers
    numbers=left,
    numbersep=5pt,
    numberstyle=\ttfamily\footnotesize\color{gray},
    %
    language=C,
    showstringspaces=false,
    % font
    basicstyle=\ttfamily\small,
    keywordstyle=\color{green!40!black},
    commentstyle=\color{gray},
    identifierstyle=\color{black},
    stringstyle=\color{orange},
}
\lstset{escapechar=`, style=cc}

\lstdefinestyle{smallcc}{
    belowcaptionskip=1\baselineskip,
    breaklines=true,
    frame=none,
    % margin
    xleftmargin=\parindent,
    % numbers
    numbers=left,
    numbersep=5pt,
    numberstyle=\ttfamily\footnotesize\color{gray},
    %
    language=C,
    showstringspaces=false,
    % font
    basicstyle=\ttfamily\small,
    keywordstyle=\color{green!40!black},
    commentstyle=\color{gray},
    identifierstyle=\color{black},
    stringstyle=\color{orange},
}

% ---------------------------------------------------------------------------
\newcommand{\dd}[1]{\mathrm{d}#1}

\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage
}

% ---------------------------------------------------------------------------
\begin{document}

    \input{tex/titlepage}
    \blankpage
    \tableofcontents

	% spacing between paragraphs
	\setlength{\parskip}{.5em}

	\include{tex/introduzione}
	\include{tex/hardware}
	\include{tex/software}
	\include{tex/conclusioni}

    %\appendix
    \include{tex/fourier-transform}
    \input{tex/bibliography}

    \afterpage{
        \newgeometry{margin=1.5cm}
        \pagestyle{empty}

        %\chapter*{Allegati}
        \addcontentsline{toc}{chapter}{Allegati}
        \stepcounter{chapter}

        \addcontentsline{toc}{section}{Pianificazione del progetto}
        \includepdf[pages={-}, angle=90]{Pianificazione.pdf}

        \addcontentsline{toc}{section}{Diario giornaliero}
        \includepdf[pages={-}]{journal.pdf}

        \addcontentsline{toc}{section}{Schema Elettrico}
        \includepdf[pages=-, angle=90]{res/schematic.pdf}

        \section*{Codice sorgente}
        \subsection*{Codice del microcontroller}
        \begin{figure}[H] \centering
            \includegraphics{figures/uml/embedded-flowchart}
            \caption{Diagramma di flusso del codice del microcontrollore}
        \end{figure}

        \lstinputlisting{../src/main.c}
        \lstinputlisting{../src/hwconfig.h}

        \subsubsection*{Fast Fourier Transform}
        \lstinputlisting{../src/fft.h}
        \lstinputlisting{../src/fft.c}

        % \subsubsection*{Controllo del display}
        % \lstinputlisting{../src/ht1632.h}
        % \lstinputlisting{../src/ht1632.c}
        
        \subsubsection*{Libreria RS232}
        \lstinputlisting{../src/rs232.h}
        \lstinputlisting{../src/rs232.c}

        \subsection*{Codice dell'applicativo desktop}
        \lstinputlisting[language=c++]{../src-desktop/main.cpp}

        \subsubsection*{Finestra principale}
        \lstinputlisting[language=c++]{../src-desktop/mainwindow.h}
        \lstinputlisting[language=c++]{../src-desktop/mainwindow.cpp}

        \subsubsection*{Gestione della risorsa seriale}
        \lstinputlisting[language=c++]{../src-desktop/serialworker.h}
        \lstinputlisting[language=c++]{../src-desktop/serialworker.cpp}

        \clearpage
        \restoregeometry
    }

\end{document}
